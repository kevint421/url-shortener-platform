apiVersion: v1
kind: ConfigMap
metadata:
  name: api-gateway-config
  namespace: urlshortener
data:
  # Gateway Settings
  SERVER_PORT: "8080"

  # Route Configuration
  SPRING_CLOUD_GATEWAY_ROUTES_0_ID: "url-service"
  SPRING_CLOUD_GATEWAY_ROUTES_0_URI: "http://url-service:8081"
  SPRING_CLOUD_GATEWAY_ROUTES_0_PREDICATES_0: "Path=/api/urls/**"

  SPRING_CLOUD_GATEWAY_ROUTES_1_ID: "analytics-service"
  SPRING_CLOUD_GATEWAY_ROUTES_1_URI: "http://analytics-service:8082"
  SPRING_CLOUD_GATEWAY_ROUTES_1_PREDICATES_0: "Path=/api/analytics/**"

  SPRING_CLOUD_GATEWAY_ROUTES_2_ID: "redirect-service"
  SPRING_CLOUD_GATEWAY_ROUTES_2_URI: "http://url-service:8081"
  SPRING_CLOUD_GATEWAY_ROUTES_2_PREDICATES_0: "Path=/{shortCode}"

  # CORS Configuration (configured via application.yml in the service)
  CORS_ALLOWED_ORIGINS: "*"
  CORS_ALLOWED_METHODS: "GET,POST,PUT,DELETE,OPTIONS"
  CORS_ALLOWED_HEADERS: "*"

  # Rate Limiting
  RATE_LIMIT_GLOBAL_ENABLED: "true"
  RATE_LIMIT_GLOBAL_CAPACITY: "1000"
  RATE_LIMIT_GLOBAL_REFILL_RATE: "100"

  # Management Endpoints
  MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE: "health,info,metrics,prometheus,gateway"
  MANAGEMENT_ENDPOINT_HEALTH_SHOW_DETAILS: "always"
